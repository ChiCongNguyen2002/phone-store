<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head th:replace="~{indexUser::header}">
</head>
<body>
<div th:replace="~{ajax_fragment::navbar}"></div>
<nav th:replace="~{indexUser::navigation}"></nav>

<!-- BREADCRUMB -->
<div id="breadcrumb" class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <div class="col-md-12">
                <ul class="breadcrumb-tree">
                    <li><a th:href="@{/indexCustomer}">Trang chủ</a></li>
                    <li class="active">Thanh toán</li>
                </ul>
            </div>
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /BREADCRUMB -->

<section class="main-container col2-right-layout">
    <div class="main container">
        <div class="row">
            <div class="col-main col-sm-12 col-xs-12">
                <div class="page-title">
                    <h2>Thanh toán</h2>
                </div>
                <div class="page-content checkout-page">
                    <h4 class="checkout-sep">1. Tóm tắt đơn hàng</h4>
                    <div class="box-border">
                        <div class="table-responsive">
                            <table class="table table-bordered cart_summary" id="tbl_cart">
                                <thead>
                                <tr>
                                    <th class="cart_product">Hình ảnh</th>
                                    <th>Tên sản phẩm</th>
                                    <th class="text-center">Tình trạng</th>
                                    <th>Giá</th>
                                    <th>Số lượng</th>
                                    <th>Tổng tiền</th>
                                    <th class="action text-center"><i class="fa fa-trash"></i></th>
                                </tr>
                                </thead>
                                <tbody id="cart_body">
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="2"></td>
                                    <td colspan="4"><strong>Tổng giá đơn hàng</strong></td>
                                    <td colspan="2"><strong><span id="lbl_total"></span> <span>&#8363;</span> </strong>
                                    </td>
                                </tr>
                                <tr id="discount_amount_row">
                                    <td colspan="2"></td>
                                    <td colspan="4"><strong>Số tiền giảm</strong></td>
                                    <td colspan="2"><strong><span id="lbl_discount_amount"></span> <span>&#8363;</span>
                                    </strong></td>
                                </tr>
                                <tr id="total_discounted_row">
                                    <td colspan="2"></td>
                                    <td colspan="4"><strong>Tổng giá đơn hàng đã giảm</strong></td>
                                    <td colspan="2"><strong><span id="lbl_total_discounted"></span> <span>&#8363;</span>
                                    </strong></td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <h4 class="checkout-sep">2. Phương thức thanh toán</h4>
                    <div class="box-border">
                        <div style="margin: 10px 0px;font-weight:500">
                            Thanh toán khi nhận hàng
                        </div>
                    </div>

                    <form asp-action="Checkout" asp-controller="Cart" method="POST">
                        <input type="hidden" asp-for="CheckoutModel.PaymentMethod" value="@PaymentMethod.COD"/>
                        <h4 class="checkout-sep">3. Thông tin giao hàng</h4>
                        <div class="box-border">
                            <ul>
                                <li class="row">
                                    <div class="col-sm-6">
                                        <label for="Name" class="required">Tên</label>
                                        <input class="input form-control" id="Name" value="@Model.Name">
                                        <span asp-validation-for="CheckoutModel.Name" class="text-danger"></span>
                                    </div>
                                </li>

                                <li class="row">
                                    <div class="col-xs-12">
                                        <label for="Address" class="required">Địa chỉ</label>
                                        <input class="input form-control" id="Address" type="text" asp-for="CheckoutModel.Address" value="@Model.Address">
                                        <span asp-validation-for="CheckoutModel.Address" class="text-danger"></span>
                                    </div>
                                    <!--/ [col] -->
                                </li>
                                <!--/ .row -->

                                <li class="row">
                                    <div class="col-sm-6">
                                        <label for="PhoneNumber" class="required">Số điện thoại</label>
                                        <input class="input form-control" id="PhoneNumber" type="text"
                                               asp-for="CheckoutModel.PhoneNumber" value="@Model.PhoneNumber">
                                        <span asp-validation-for="CheckoutModel.PhoneNumber" class="text-danger"></span>
                                    </div>
                                    <!--/ [col] -->
                                </li>
                                <!--/ .row -->
                            </ul>
                        </div>
                        <button class="button pull-right"><span>Đặt hàng</span></button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<footer th:replace="~{indexUser::footer}"></footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script th:fragment="ajax_script">
    var iconElement = document.querySelector('.fa.fa-user-o.userID');
    var uid = iconElement.getAttribute('data-user-id');
    console.log(uid)
    function fetchDataOnModalShow() {
        $.ajax({
            url: "/api/index",
            type: "GET",
            data: {
                userId: uid
            },
        }).done(function(response) {
            var responseLength = response.length;
            console.log(responseLength);
            var sumQuantity = document.querySelector(".sumQuantity");
            sumQuantity.innerHTML = responseLength;

        }).fail(function(error) {
            console.error(error);
        });
    }

    window.onload = function() {
      fetchDataOnModalShow();
    };
</script>
</body>
</html>